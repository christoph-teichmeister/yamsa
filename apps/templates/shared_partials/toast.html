<div class="toast-container yamsa-toast-container position-fixed bottom-0 start-50 translate-middle-x px-1 pb-5 mb-5 w-100"
     style="z-index: 1400">
    <div class="toast yamsa-toast w-100 border-0"
         id="toast-id"
         role="alert"
         aria-live="assertive"
         aria-atomic="true">
        <div id="toast-type-div"
             class="toast-yamsa-inner d-flex align-items-center justify-content-between gap-3 rounded-4 shadow-sm px-4 py-3">
            <span id="toast-message-span"
                  class="flex-grow-1 fw-semibold fs-6 text-truncate"></span>
            <button type="button"
                    class="btn-close btn-close-white"
                    data-bs-dismiss="toast"
                    aria-label="Close"></button>
        </div>
    </div>
</div>
<!-- Toast handler -->
<script type="module">
    const toastElement = document.getElementById('toast-id')
    const toastTypeDiv = document.getElementById('toast-type-div')
    const toastMessageSpan = document.getElementById('toast-message-span')
    const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastElement)

    const baseToastClasses = 'toast-yamsa-inner d-flex align-items-center justify-content-between gap-3 rounded-4 shadow-sm px-4 py-3'
    const defaultErrorToastClasses = "{{ toast_classes.error|escapejs }}"
    let toastIsVisible = false

    const applyToastClasses = (classString = "") => {
        toastTypeDiv.className = baseToastClasses
        classString.split(" ").forEach(typeString => {
            if (typeString.trim()) {
                toastTypeDiv.classList.add(typeString)
            }
        })
    }

    toastElement.addEventListener("shown.bs.toast", () => {
        toastIsVisible = true
    })

    toastElement.addEventListener("hidden.bs.toast", () => {
        toastIsVisible = false
    })

    document.body.addEventListener("triggerToast", (evt) => {
        if (toastIsVisible) {
            return
        }

        toastMessageSpan.innerText = evt.detail.message
        applyToastClasses(evt.detail.type)

        toastBootstrap.show()
    })

    document.body.addEventListener("htmx:afterRequest", (evt) => {
        if (evt.detail.successful) return

        toastMessageSpan.innerText = "âš ï¸ Something went wrong ğŸ¥º"
        applyToastClasses(defaultErrorToastClasses)
        toastBootstrap.show()
    })
</script>
