{% extends "core/base.html" %}
{% load static %}
{% load room_tags %}

{% block title %}yamsa | {{ current_room.name }}{% endblock %}

{% block content %}
    {% if request.user.is_authenticated %}
        {# Room Tab-Headers #}
        <ul class="nav nav-tabs nav-fill" id="roomTab" role="tablist">

            {% for tab in dashboard_tabs %}
                <li class="nav-item" role="presentation" style="cursor: pointer">
                    <a id="{{ tab.name }}-tab"
                       class="nav-link {% if active_tab == tab.name %}active{% endif %}"
                       role="tab"
                       data-bs-toggle="tab"
                       data-bs-target="#{{ tab.name }}-tab-content"
                       aria-controls="{{ tab.name }}-tab-content"
                       aria-selected="true"
                       hx-trigger="click"
                       hx-get="{{ tab.get_url }}"
                       hx-target="#body"
                       hx-swap="innerHTML"
                       hx-indicator="#loading-spinner"
                       hx-push-url="true"
                    >
                        <i class="{{ tab.icon_class }}"></i>
                    </a>
                </li>
            {% endfor %}

        </ul>

        {# Room Tab-Contents #}
        <div class="tab-content" id="tab-content">

            {% for tab in dashboard_tabs %}
                <div class="tab-pane fade {% if active_tab == tab.name %}show active{% endif %}"
                     id="{{ tab.name }}-tab-content"
                     role="tabpanel"
                     aria-labelledby="{{ tab.name }}-tab"
                     tabindex="0"
                >
                    {% if active_tab == tab.name %}
                        {% block tab_content %}
                            {% include "shared_partials/loading_spinner.html" with spinner_id="loading-spinner" %}
                        {% endblock %}
                    {% else %}
                        {% include "shared_partials/loading_spinner.html" with spinner_id="loading-spinner" %}
                    {% endif %}
                    <br><br><br>
                </div>
            {% endfor %}

        </div>
    {% else %}
        {% include "room/partials/_detail_who_are_you.html" %}
    {% endif %}

    <script type="module">
      // TODO CT: Joa keine Ahnung, fix this I guess
      /*
      const triggerTabList = document.querySelectorAll('#roomTab a')

      let currentActiveTab = undefined
      let nextTabToBeActive = undefined

      const getNextIndex = (index, swipeDirection) => {
        if (swipeDirection === "swipeleft") {
          return index + 1 > triggerTabList.length - 1 ? 0 : index + 1
        } else if (swipeDirection === "swiperight") {
          return index - 1 < 0 ? triggerTabList.length - 1 : index - 1
        }
        return index
      }

      $(function () {
        $("#tab-content").on("swipeleft", swipeHandler).on("swiperight", swipeHandler);

        // Callback function references the event target and adds the 'swipe' class to it
        function swipeHandler(event) {
          console.log(event.type)
          console.log("currentActiveTab", currentActiveTab)
          console.log("nextTabToBeActive", nextTabToBeActive)

          triggerTabList.forEach((el, index) => {
            if (el.getAttribute("aria-selected") === "true") {
              currentActiveTab = el

              nextTabToBeActive = triggerTabList[getNextIndex(index, event.type)]

              window.bootstrap.Tab.getOrCreateInstance(nextTabToBeActive).show()
              return false;
            }
          })
        }
      });
       */
    </script>
{% endblock %}
