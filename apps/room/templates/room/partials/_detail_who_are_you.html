{% load i18n %}
<div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">
        <div class="card shadow-sm border-0 rounded-4 px-3 px-md-5 py-5">
            <div class="card-body">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-3 mb-4">
                    <div>
                        <p class="text-uppercase text-muted small mb-1">{% trans "Guest access" %}</p>
                        <h2 class="fw-semibold mb-1">{{ current_room.name }}</h2>
                    </div>
                    <span class="badge rounded-pill {{ current_room.is_closed|yesno:'text-bg-danger,text-bg-success' }} py-2 px-3">
                        {% if current_room.is_closed %}
                            <i class="bi bi-lock-fill me-1"></i>{% trans "Closed" %}
                        {% else %}
                            <i class="bi bi-share-fill me-1"></i>{% trans "Open to guests" %}
                        {% endif %}
                    </span>
                </div>
                <p class="text-muted small mb-3">
                    {% blocktrans trimmed %}
                        Maybe register? A free account keeps your rooms, reminders, and history together.
                    {% endblocktrans %}
                </p>
                <div class="alert alert-primary rounded-4 px-4 py-3 mb-4 d-flex flex-column flex-md-row align-items-start gap-3">
                    <div class="fs-3 text-primary-emphasis">
                        <i class="bi bi-person-plus-fill"></i>
                    </div>
                    <div class="flex-grow-1">
                        <p class="fw-semibold mb-1">{% trans "Claim your invitation" %}</p>
                        <p class="mb-2 small text-muted">
                            {% trans "Guests who arrive via the shared link can register or log in here to confirm their spot." %}
                        </p>
                        <div class="d-flex flex-wrap gap-2 justify-content-center">
                            <a class="btn btn-sm btn-outline-light px-3"
                               href="{% url 'account:register' %}">{% trans "Create a free account" %}</a>
                            <a class="btn btn-sm btn-link px-3" href="{% url 'account:login' %}">{% trans "Already have an account?" %}</a>
                        </div>
                    </div>
                </div>
                {% if current_room.has_guests %}
                    <form action="{% url 'account:guest-login' %}" method="post">
                        {% csrf_token %}
                        <div class="mb-4 form-group">
                            <div class="row px-2 mt-2 align-items-center">
                                <div class="col">
                                    <h5 class="mb-0">
                                        <label for="userSelect" class="form-label">{% trans "Who are you?" %}</label>
                                    </h5>
                                </div>
                            </div>
                            <select name="user_id"
                                    class="form-control form-select mb-1"
                                    id="userSelect"
                                    required>
                                {% for guest_user in current_room.guest_users %}
                                    <option value="{{ guest_user.id }}">{{ guest_user.name }}</option>
                                {% endfor %}
                            </select>
                            <div class="text-muted small d-flex justify-content-start px-2 mb-3">
                                <button type="button"
                                        class="cursor-pointer border-0 bg-transparent p-0 small text-muted d-inline-flex align-items-center gap-1"
                                        data-bs-toggle="popover"
                                        data-bs-placement="top"
                                        data-bs-content="{% blocktrans trimmed %}Only Guest Users of the room are shown here. If you do not see your name, that means that you either are not part of this room or that you already have an account. If you already have an account, try logging in.{% endblocktrans %}"
                                        aria-describedby="guest-access-popover-desc">
                                    {% trans "Not seeing your name?" %} <i class="bi bi-question-circle"></i>
                                </button>
                                <span id="guest-access-popover-desc" class="visually-hidden">
                                    {% blocktrans trimmed %}
                                        Only Guest Users of the room are shown here. If you do not see your name, that means that you either are not part of this room or that you already have an account. If you already have an account, try logging in.
                                    {% endblocktrans %}
                                </span>
                            </div>
                        </div>
                        <div class="form-group" hidden>
                            <label for="room_slug" class="form-label">{% trans "Room" %}</label>
                            <input id="room_slug"
                                   name="room_slug"
                                   type="text"
                                   class="form-control"
                                   required
                                   value="{{ current_room.slug }}" />
                        </div>
                        <div class="d-flex justify-content-center">
                            <button type="submit" class="btn btn-primary px-4 py-2">{% trans "That's me!" %}</button>
                        </div>
                    </form>
                {% else %}
                    <div class="alert alert-info rounded-4 px-4 py-3 mb-3 text-muted small">
                        {% trans "No guests have been invited yet. Create an account to add yourself to the room." %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
